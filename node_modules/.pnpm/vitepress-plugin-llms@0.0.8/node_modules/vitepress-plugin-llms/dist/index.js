// Built with tsup
import g from"node:fs";import f from"node:path";import m from"picocolors";import{minimatch as G}from"minimatch";import b from"node:fs";import p from"node:path";import h from"gray-matter";import V from"markdown-title";var y=`# {title}

{description}

## Table of Contents

{toc}`;var F=e=>({dir:p.dirname(e),file:p.basename(e)}),S=e=>{let{dir:t,file:i}=F(e);return p.join(t,p.basename(i,p.extname(i)))},w=e=>{let{dir:t,file:i}=F(e);return p.posix.join(t,p.basename(i,p.extname(i)))};function T(e){let t=h(e);return t.data?.titleTemplate||t.data?.title||t.data?.hero?.name||V(e)}function j(e,t){let i="";for(let l of e){let a=p.relative(t,l.path);i+=`- [${l.title}](/${w(a)}.md)
`}return i}function P(e,t,i,l=y){let a=h(b.readFileSync(t,"utf-8")),r=l;return r=r.replace(/{title}/gi,T(a.orig.toString())||"LLMs Documentation"),r=r.replace(/{description}/gi,a.data?.hero?.tagline||a.data?.titleTemplate||"This file contains links to all documentation sections."),r=r.replace(/{toc}/gi,j(e,i)),r}function D(e,t){return e.map(l=>{let a=p.relative(t,l.path),r=h(b.readFileSync(l.path,"utf-8"));return h.stringify(r.content,{url:`/${w(a)}.md`})}).join(`
---

`)}import v from"picocolors";var L=v.blue("llmstxt")+v.dim(" \xBB "),E={info:e=>console.log(`${L}  ${e}`),success:e=>console.log(`${L}${v.green("\u2713")} ${e}`),warn:e=>console.warn(`${L}${v.yellow("\u26A0")} ${v.yellow(e)}`),error:e=>console.error(`${L}${v.red("\u2717")} ${v.red(e)}`)},n=E;import C from"gray-matter";var $="vitepress-plugin-llms";var N=$;function W(e={}){let t={generateLLMsFullTxt:!0,generateLLMsTxt:!0,ignoreFiles:[],customLLMsTxtTemplate:y,...e},i,l=new Set,a=!1;return{name:N,enforce:"post",configResolved(r){i=r,t.workDir?t.workDir=f.resolve(i.vitepress.srcDir,t.workDir):t.workDir=i.vitepress.srcDir,a=!!r.build?.ssr,n.info(`Plugin initialized ${a?m.dim("(SSR build)"):m.dim("(client build)")}`)},configureServer(r){n.info("Development server configured to serve markdown files"),r.middlewares.use((c,d,x)=>{if(c.url?.endsWith(".md")||c.url?.endsWith(".txt"))try{let s=f.resolve(i.vitepress?.outDir??"dist",`${S(c.url)}.md`),o=g.readFileSync(s,"utf-8");d.setHeader("Content-Type","text/markdown"),d.end(o);return}catch{x()}x()})},buildStart(){l.clear(),n.info("Build started, file collection cleared")},transform(r,c){if(!c.endsWith(".md")||!c.startsWith(t.workDir))return null;if(t.ignoreFiles?.length){for(let d of t.ignoreFiles)if(typeof d=="string"&&G(f.relative(t.workDir,c),d))return null}return l.add(c),null},generateBundle(){if(a){n.info("Skipping file generation in SSR build");return}let r=i.vitepress?.outDir??"dist";g.existsSync(r)||(n.info(`Creating output directory: ${m.cyan(r)}`),g.mkdirSync(r,{recursive:!0}));let c=Array.from(l),d=c.length;if(d===0){n.warn("No markdown files found to process");return}n.info(`Processing ${m.bold(d.toString())} markdown files...`);let x=[];for(let s of c){let o=f.relative(t.workDir,s),k=f.resolve(r,o);try{let u=C(g.readFileSync(s,"utf-8")),M=T(u.orig.toString())||"Untitled";x.push({title:M,path:s}),g.mkdirSync(f.dirname(k),{recursive:!0}),u.data={url:`/${w(o)}.md`},u.data?.description?.length&&(u.data.description=u.data?.description),g.writeFileSync(k,C.stringify(u.content,u.data)),n.success(`Copied ${m.cyan(o)} to output directory`)}catch(u){n.error(`Failed to copy ${m.cyan(o)}: ${u.message}`)}}if(x.sort((s,o)=>s.title.localeCompare(o.title)),t.generateLLMsTxt){let s=f.resolve(r,"llms.txt"),o=P(x,f.resolve(t.workDir,"index.md"),t.workDir,t.customLLMsTxtTemplate||y);g.writeFileSync(s,o,"utf-8"),n.success(`Generated ${m.cyan("llms.txt")} with ${m.bold(d.toString())} documentation sections`)}if(t.generateLLMsFullTxt){let s=f.resolve(r,"llms-full.txt");n.info(`Generating ${m.cyan("llms-full.txt")}...`);let o=D(x,t.workDir);g.writeFileSync(s,o,"utf-8"),n.success(`Generated ${m.cyan("llms-full.txt")} with ${m.bold(d.toString())} markdown files`)}}}}export{W as default};
//# sourceMappingURL=index.js.map